<!DOCTYPE html>
<html>
<head>
    <script src="../../../lib/VSS.SDK.min.js"></script>
    <script src="../../library.js"></script>
    <script src="../chart/chart.js"></script>
    <script src="hub.js"></script>
    <link rel="stylesheet" href="../../styles.css" />
</head>
<body>
    <script lang="">
        VSS.init({
                explicitNotifyLoaded: true,
                usePlatformStyles: true
            });

        VSS.require([
                    "TFS/Dashboards/WidgetHelpers",
                    "Charts/Services",
                    "VSS/Context",
                    "VSS/Authentication/Services"
                ],

            // top level function
            async function (WidgetHelpers, Services, context) {
                consoleLog('VSS.require function');
                try {
                    consoleLog('VSS.register Hub function');

                    const chartService = await Services.ChartsService.getService();
                    const webContext = VSS.getWebContext();
                    const project = webContext.project;
                    const organization = webContext.account.name;
                    const projectId = project.id;
                    // convert project.name to url encoding
                    const projectName = project.name.replace(/ /g, "%20").replace(/&/g, "%26");

                    consoleLog('project id: ' + projectId);
                    consoleLog('project name: ' + projectName);
                    consoleLog('organization name: ' + organization);

                    const titleElement = $('h2.ghazdoTitle')[0];
                    const containerElement = $('#Chart-Container')[0];

                    // create the charts
                    await createCharts({chartService, containerElement, titleElement, projectName, organization});

                    consoleLog('returning WidgetStatusHelper.Success()');
                }
                catch (err) {
                    consoleLog(`Error loading the page contents: ${JSON.stringify(err)}`);
                }
                VSS.notifyLoadSucceeded();
            }
        );
    </script>

    <div class="widget">
        <h2 class="loadingTitle">Loading information div</h2>
        <div id="LoadingInfoContainer"></div>
    </div>

    <div class="widget">
        <h2 class="ghazdoTitle">GHAzDo Hub test from Rob Bos's widget</h2>
        <div id="Chart-Container"></div>
    </div>

    <style>
        .widget {
            width: 320px;
            border: solid 1px silver;
            margin-left: 11px;
            margin-top: 10px;
            padding: 5px 5px 5px 5px;
        }

        .region-headerBreadcrumb {
           display: none;
        }
    </style>
</body>
</html>